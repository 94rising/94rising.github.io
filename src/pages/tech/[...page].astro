---
import type { GetStaticPathsOptions, Page } from "astro";
import { type CollectionEntry, getCollection } from "astro:content";
import Pagination from "../../components/Pagination.astro";
import { sortItemsByDateDesc, getTechPosts } from "../../utils/helpers";
import MainLayout from "../../layouts/MainLayout.astro";
import siteConfig from "../../site.config";
import PostCardPreview from "../../components/PostCardPreview.astro";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const allBlogs = (await getCollection("blogs")).sort(sortItemsByDateDesc);
  const techBlogs = getTechPosts(allBlogs);
  return paginate(techBlogs, { pageSize: siteConfig.postsPerPage || 10 });
}

type Props = { page: Page<CollectionEntry<"blogs">> };

const { page } = Astro.props;
const allPosts = page.data;
---

<MainLayout activePage="tech" pageTitle={siteConfig.title + " | Tech Archive"}>
  <div class="page-content py-8 text-center">
    <h1 class="sigmar-ff">Tech</h1>
    <p class="font-light text-balance">기술 관련 글 모음</p>

    <div
      class="flex flex-col text-left gap-8 mb-4 text-sm sm:text-base max-w-fit mx-auto"
    >
      {allPosts.map((post) => <PostCardPreview post={post} basePath="/tech" />)}
    </div>
    <Pagination page={page} class="mb-16 sm:mb-24" />
  </div>
</MainLayout>
